<div class="page">
  <div class="container">
    <app-navbar></app-navbar>
    <div class="layout-grid">
      <!-- Left Column: Input -->
      <div class="input-column">
        <div class="card">
          <h2 class="section-title">Check News Credibility</h2>
          <p class="muted mb-4">Paste the news text below to analyze its authenticity.</p>
          
          <form [formGroup]="checkForm" (ngSubmit)="onSubmit()">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>News Text</mat-label>
              <textarea matInput formControlName="text" rows="8" placeholder="Paste article text here..."></textarea>
              <mat-error *ngIf="checkForm.get('text')?.hasError('required')">News text is required</mat-error>
            </mat-form-field>
            
            <div class="form-row">
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Source Platform (Optional)</mat-label>
                <input matInput formControlName="sourcePlatform" placeholder="e.g. Twitter, Reddit">
              </mat-form-field>
              
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>URL (Optional)</mat-label>
                <input matInput formControlName="url" placeholder="https://example.com/article">
              </mat-form-field>
            </div>

            <div class="action-row">
              <button mat-flat-button color="primary" type="submit" [disabled]="checkForm.invalid || loading" class="action-btn">
                Check Credibility
              </button>
              <button mat-stroked-button type="button" (click)="clearForm()" [disabled]="loading" class="action-btn">
                Clear
              </button>
            </div>
            
            <div *ngIf="error" class="error-message mt-4">
              <mat-icon inline>error</mat-icon> {{ error }}
            </div>
          </form>
        </div>
      </div>

      <!-- Right Column: Results -->
      <div class="results-column">
        <!-- Loading Skeleton / Placeholder -->
        <div *ngIf="loading" class="card loading-card">
          <div class="skeleton-header"></div>
          <div class="skeleton-line"></div>
          <div class="skeleton-line short"></div>
          <div class="skeleton-block"></div>
        </div>

        <!-- Empty State -->
        <div *ngIf="!loading && !prediction && !error" class="card empty-state">
          <mat-icon class="empty-icon">analytics</mat-icon>
          <h3>Ready to Analyze</h3>
          <p class="muted">Enter news text and click check to see AI-powered insights here.</p>
        </div>

        <!-- Result Cards -->
        <ng-container *ngIf="prediction && !loading">
          <!-- Result Summary -->
          <div class="card result-card" [ngClass]="isFake ? 'status-fake' : 'status-real'">
            <div class="result-header">
              <span class="status-pill" [ngClass]="isFake ? 'fake' : 'real'">
                {{ prediction?.output?.label | uppercase }}
              </span>
              <span class="confidence-label">
                {{ confidencePercentage | number:'1.0-0' }}% Confidence
              </span>
            </div>
            
            <mat-progress-bar 
              mode="determinate" 
              [value]="confidencePercentage" 
              [color]="isFake ? 'warn' : 'primary'"
              class="confidence-bar">
            </mat-progress-bar>
            
            <p class="summary-text">
              This content appears to be <strong>{{ prediction?.output?.label }}</strong>.
            </p>
          </div>

          <!-- Explanation -->
          <div class="card">
            <h3 class="card-title">Analysis</h3>
            <p class="explanation-text">{{ prediction?.explanation?.summary }}</p>
            
            <div *ngIf="prediction?.explanation?.highlights?.length" class="highlights-section">
              <h4 class="subsection-title">Key Indicators</h4>
              <mat-chip-set>
                <mat-chip *ngFor="let h of prediction!.explanation.highlights" class="indicator-chip">
                  {{ h.span }}
                </mat-chip>
              </mat-chip-set>
            </div>
             <!-- <p class="muted mt-4 text-sm"><strong>Method:</strong> {{ prediction?.explanation?.method }}</p> -->
          </div>

          <!-- Social Context -->
          <div class="card" *ngIf="prediction?.socialContext?.length">
            <h3 class="card-title">Social Context</h3>
            <mat-tab-group>
              <mat-tab label="All Sources">
                <div class="social-list">
                  <div *ngFor="let post of prediction!.socialContext" class="social-item">
                    <div class="social-header">
                      <span class="social-source">{{ post.source }}</span>
                      <span class="social-date" *ngIf="post.published">{{ post.published }}</span>
                    </div>
                    <p class="social-text">{{ post.text }}</p>
                  </div>
                </div>
              </mat-tab>
            </mat-tab-group>
          </div>
        </ng-container>
      </div>
    </div>
  </div>
</div>